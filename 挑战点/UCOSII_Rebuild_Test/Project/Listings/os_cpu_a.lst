


ARM Macro Assembler    Page 1 


    1 00000000         
    2 00000000                 EXTERN           OSRunning   ; External referenc
                                                            es
    3 00000000                 EXTERN           OSPrioCur
    4 00000000                 EXTERN           OSPrioHighRdy
    5 00000000                 EXTERN           OSTCBCur
    6 00000000                 EXTERN           OSTCBHighRdy
    7 00000000                 EXTERN           OSIntExit
    8 00000000                 EXTERN           OSTaskSwHook
    9 00000000                 EXTERN           OS_CPU_ExceptStkBase
   10 00000000                 EXTERN           OS_KA_BASEPRI_Boundary
   11 00000000         
   12 00000000                 EXPORT           OS_CPU_SR_Save
   13 00000000                 EXPORT           OS_CPU_SR_Restore
   14 00000000                 EXPORT           OSCtxSw
   15 00000000                 EXPORT           OSIntCtxSw
   16 00000000                 EXPORT           OSStartHighRdy
   17 00000000                 EXPORT           PendSV_Handler
   18 00000000                 EXPORT           SystemInit
   19 00000000         
   20 00000000         ;*******************************************************
                       *************************************************
   21 00000000         ;                                               EQUATES
   22 00000000         ;*******************************************************
                       *************************************************
   23 00000000         
   24 00000000 E000ED04 
                       NVIC_INT_CTRL
                               EQU              0xE000ED04  ; Interrupt control
                                                             state register.
   25 00000000 E000ED22 
                       NVIC_SYSPRI14
                               EQU              0xE000ED22  ; System priority r
                                                            egister (priority 1
                                                            4).
   26 00000000 000000FF 
                       NVIC_PENDSV_PRI
                               EQU              0xFF        ; PendSV priority v
                                                            alue (lowest).
   27 00000000 10000000 
                       NVIC_PENDSVSET
                               EQU              0x10000000  ; Value to trigger 
                                                            PendSV exception.
   28 00000000         
   29 00000000         
   30 00000000                 AREA             |.text|, CODE, READONLY, ALIGN=
2
   31 00000000                 THUMB
   32 00000000                 REQUIRE8
   33 00000000                 PRESERVE8
   34 00000000         
   35 00000000         ;*******************************************************
                       *************************************************
   36 00000000         ;                                   CRITICAL SECTION MET
                       HOD 3 FUNCTIONS
   37 00000000         ;
   38 00000000         ; Description : Disable/Enable Kernel aware interrupts b
                       y preserving the state of BASEPRI.  Generally speaking,
   39 00000000         ;               the state of the BASEPRI interrupt excep



ARM Macro Assembler    Page 2 


                       tion processing is stored in the local variable
   40 00000000         ;               'cpu_sr' & Kernel Aware interrupts are t
                       hen disabled ('cpu_sr' is allocated in all functions
   41 00000000         ;               that need to disable Kernel aware interr
                       upts). The previous BASEPRI interrupt state is restored
   42 00000000         ;               by copying 'cpu_sr' into the BASEPRI reg
                       ister.
   43 00000000         ;
   44 00000000         ; Prototypes  : OS_CPU_SR  OS_CPU_SR_Save   (OS_CPU_SR  
                       new_basepri);
   45 00000000         ;               void       OS_CPU_SR_Restore(OS_CPU_SR  
                       cpu_sr);
   46 00000000         ;
   47 00000000         ;
   48 00000000         ; Note(s)     : 1) These functions are used in general l
                       ike this:
   49 00000000         ;
   50 00000000         ;                  void Task (void *p_arg)
   51 00000000         ;                  {
   52 00000000         ;                  #if OS_CRITICAL_METHOD == 3          
                       /* Allocate storage for CPU status register  */
   53 00000000         ;                      OS_CPU_SR  cpu_sr;
   54 00000000         ;                  #endif
   55 00000000         ;
   56 00000000         ;                          :
   57 00000000         ;                          :
   58 00000000         ;                      OS_ENTER_CRITICAL();             
                       /* cpu_sr = OS_CPU_SR_Save(new_basepri);     */
   59 00000000         ;                          :
   60 00000000         ;                          :
   61 00000000         ;                      OS_EXIT_CRITICAL();              
                       /* OS_CPU_RestoreSR(cpu_sr);                 */
   62 00000000         ;                          :
   63 00000000         ;                          :
   64 00000000         ;                  }
   65 00000000         ;
   66 00000000         ;               2) Increasing priority using a write to 
                       BASEPRI does not take effect immediately.
   67 00000000         ;                  (a) IMPLICATION  This erratum means t
                       hat the instruction after an MSR to boost BASEPRI
   68 00000000         ;                      might incorrectly be preempted by
                        an insufficient high priority exception.
   69 00000000         ;
   70 00000000         ;                  (b) WORKAROUND  The MSR to boost BASE
                       PRI can be replaced by the following code sequence:
   71 00000000         ;
   72 00000000         ;                      CPSID i
   73 00000000         ;                      MSR to BASEPRI
   74 00000000         ;                      DSB
   75 00000000         ;                      ISB
   76 00000000         ;                      CPSIE i
   77 00000000         ;*******************************************************
                       *************************************************
   78 00000000         
   79 00000000         OS_CPU_SR_Save
   80 00000000 B672            CPSID            I           ; Cortex-M7 errata 
                                                            notice. See Note #2
                                                            
   81 00000002 B402            PUSH             {R1}



ARM Macro Assembler    Page 3 


   82 00000004 F3EF 8111       MRS              R1, BASEPRI
   83 00000008 F380 8811       MSR              BASEPRI, R0
   84 0000000C F3BF 8F4F       DSB
   85 00000010 F3BF 8F6F       ISB
   86 00000014 4608            MOV              R0, R1
   87 00000016 BC02            POP              {R1}
   88 00000018 B662            CPSIE            I
   89 0000001A 4770            BX               LR
   90 0000001C         
   91 0000001C         OS_CPU_SR_Restore
   92 0000001C B672            CPSID            I           ; Cortex-M7 errata 
                                                            notice. See Note #2
                                                            
   93 0000001E F380 8811       MSR              BASEPRI, R0
   94 00000022 F3BF 8F4F       DSB
   95 00000026 F3BF 8F6F       ISB
   96 0000002A B662            CPSIE            I
   97 0000002C 4770            BX               LR
   98 0000002E         
   99 0000002E         
  100 0000002E         ;*******************************************************
                       *************************************************
  101 0000002E         ;                                         START MULTITAS
                       KING
  102 0000002E         ;                                      void OSStartHighR
                       dy(void)
  103 0000002E         ;
  104 0000002E         ; Note(s) : 1) This function triggers a PendSV exception
                        (essentially, causes a context switch) to cause
  105 0000002E         ;              the first task to start.
  106 0000002E         ;
  107 0000002E         ;           2) During task execution, PSP is used as the
                        stack pointer.
  108 0000002E         ;              When an exception occurs, the core will s
                       witch to MSP until the exception return.
  109 0000002E         ;
  110 0000002E         ;           3) OSStartHighRdy() MUST:
  111 0000002E         ;              a) Setup PendSV exception priority to low
                       est;
  112 0000002E         ;              b) Set initial PSP to 0, to tell context 
                       switcher this is first run;
  113 0000002E         ;              c) Set the main stack to OS_CPU_ExceptStk
                       Base
  114 0000002E         ;              d) Set OSRunning to TRUE;
  115 0000002E         ;              e) Get current high priority, OSPrioCur =
                        OSPrioHighRdy;
  116 0000002E         ;              f) Get current ready thread TCB, OSTCBCur
                        = OSTCBHighRdy;
  117 0000002E         ;              g) Get new process SP from TCB, SP = OSTC
                       BHighRdy->OSTCBStkPtr;
  118 0000002E         ;              h) Restore R0-R11 and R14 from new proces
                       s stack;
  119 0000002E         ;              i) Enable interrupts (tasks will run with
                        interrupts enabled).
  120 0000002E         ;*******************************************************
                       *************************************************
  121 0000002E         
  122 0000002E         OSStartHighRdy
  123 0000002E B672            CPSID            I           ; Prevent interrupt



ARM Macro Assembler    Page 4 


                                                            ion during context 
                                                            switch
  124 00000030 484E            LDR              R0, =NVIC_SYSPRI14 ; Set the Pe
                                                            ndSV exception prio
                                                            rity
  125 00000032 F04F 01FF       LDR              R1, =NVIC_PENDSV_PRI
  126 00000036 7001            STRB             R1, [R0]
  127 00000038         
  128 00000038 2000            MOVS             R0, #0      ; Set the PSP to 0 
                                                            for initial context
                                                             switch call
  129 0000003A F380 8809       MSR              PSP, R0
  130 0000003E         
  131 0000003E 484C            LDR              R0, =OS_CPU_ExceptStkBase ; Ini
                                                            tialize the MSP to 
                                                            the OS_CPU_ExceptSt
                                                            kBase
  132 00000040 6801            LDR              R1, [R0]
  133 00000042 F381 8808       MSR              MSP, R1
  134 00000046         
  135 00000046 F7FF FFFE       BL               OSTaskSwHook ; Call OSTaskSwHoo
                                                            k() for FPU Push & 
                                                            Pop
  136 0000004A         
  137 0000004A 484A            LDR              R0, =OSRunning 
                                                            ; OSRunning = TRUE
  138 0000004C 2101            MOVS             R1, #1
  139 0000004E 7001            STRB             R1, [R0]
  140 00000050         
  141 00000050 4849            LDR              R0, =OSPrioCur ; OSPrioCur = OS
                                                            PrioHighRdy;
  142 00000052 494A            LDR              R1, =OSPrioHighRdy
  143 00000054 780A            LDRB             R2, [R1]
  144 00000056 7002            STRB             R2, [R0]
  145 00000058         
  146 00000058 4849            LDR              R0, =OSTCBCur ; OSTCBCur  = OST
                                                            CBHighRdy;
  147 0000005A 494A            LDR              R1, =OSTCBHighRdy
  148 0000005C 680A            LDR              R2, [R1]
  149 0000005E 6002            STR              R2, [R0]
  150 00000060         
  151 00000060 6810            LDR              R0, [R2]    ; R0 is new process
                                                             SP; SP = OSTCBHigh
                                                            Rdy->OSTCBStkPtr;
  152 00000062 F380 8809       MSR              PSP, R0     ; Load PSP with new
                                                             process SP
  153 00000066         
  154 00000066 F3EF 8014       MRS              R0, CONTROL
  155 0000006A F040 0002       ORR              R0, R0, #2
  156 0000006E F380 8814       MSR              CONTROL, R0
  157 00000072 F3BF 8F6F       ISB                          ; Sync instruction 
                                                            stream
  158 00000076         
  159 00000076 E8BD 4FF0       LDMFD            SP!, {R4-R11, LR} ; Restore r4-
                                                            11, lr from new pro
                                                            cess stack
  160 0000007A BC0F            LDMFD            SP!, {R0-R3} ; Restore r0, r3
  161 0000007C E8BD 5000       LDMFD            SP!, {R12, LR} 
                                                            ; Load R12 and LR



ARM Macro Assembler    Page 5 


  162 00000080 BC06            LDMFD            SP!, {R1, R2} ; Load PC and dis
                                                            card xPSR
  163 00000082 B662            CPSIE            I
  164 00000084 4708            BX               R1
  165 00000086         
  166 00000086         
  167 00000086         ;*******************************************************
                       *************************************************
  168 00000086         ;                       PERFORM A CONTEXT SWITCH (From t
                       ask level) - OSCtxSw()
  169 00000086         ;                   PERFORM A CONTEXT SWITCH (From inter
                       rupt level) - OSIntCtxSw()
  170 00000086         ;
  171 00000086         ; Note(s) : 1) OSCtxSw() is called when OS wants to perf
                       orm a task context switch.  This function
  172 00000086         ;              triggers the PendSV exception which is wh
                       ere the real work is done.
  173 00000086         ;
  174 00000086         ;           2) OSIntCtxSw() is called by OSIntExit() whe
                       n it determines a context switch is needed as
  175 00000086         ;              the result of an interrupt.  This functio
                       n simply triggers a PendSV exception which will
  176 00000086         ;              be handled when there are no more interru
                       pts active and interrupts are enabled.
  177 00000086         ;*******************************************************
                       *************************************************
  178 00000086         
  179 00000086         OSCtxSw
  180 00000086         OSIntCtxSw
  181 00000086         
  182 00000086 4840            LDR              R0, =NVIC_INT_CTRL ; Trigger th
                                                            e PendSV exception 
                                                            (causes context swi
                                                            tch)
  183 00000088 F04F 5180       LDR              R1, =NVIC_PENDSVSET
  184 0000008C 6001            STR              R1, [R0]
  185 0000008E 4770            BX               LR
  186 00000090         
  187 00000090         
  188 00000090         ;*******************************************************
                       *************************************************
  189 00000090         ;                                       HANDLE PendSV EX
                       CEPTION
  190 00000090         ;                                   void OS_CPU_PendSVHa
                       ndler(void)
  191 00000090         ;
  192 00000090         ; Note(s) : 1) PendSV is used to cause a context switch.
                         This is a recommended method for performing
  193 00000090         ;              context switches with Cortex-M.  This is 
                       because the Cortex-M auto-saves half of the
  194 00000090         ;              processor context on any exception, and r
                       estores same on return from exception.  So only
  195 00000090         ;              saving of R4-R11 & R14 is required and fi
                       xing up the stack pointers. Using the PendSV exception
  196 00000090         ;              this way means that context saving and re
                       storing is identical whether it is initiated from
  197 00000090         ;              a thread or occurs due to an interrupt or
                        exception.
  198 00000090         ;



ARM Macro Assembler    Page 6 


  199 00000090         ;           2) Pseudo-code is:
  200 00000090         ;              a) Get the process SP
  201 00000090         ;              b) Save remaining regs r4-r11 & r14 on pr
                       ocess stack;
  202 00000090         ;              c) Save the process SP in its TCB, OSTCBC
                       ur->OSTCBStkPtr = SP;
  203 00000090         ;              d) Call OSTaskSwHook();
  204 00000090         ;              e) Get current high priority, OSPrioCur =
                        OSPrioHighRdy;
  205 00000090         ;              f) Get current ready thread TCB, OSTCBCur
                        = OSTCBHighRdy;
  206 00000090         ;              g) Get new process SP from TCB, SP = OSTC
                       BHighRdy->OSTCBStkPtr;
  207 00000090         ;              h) Restore R4-R11 and R14 from new proces
                       s stack;
  208 00000090         ;              i) Perform exception return which will re
                       store remaining context.
  209 00000090         ;
  210 00000090         ;           3) On entry into PendSV handler:
  211 00000090         ;              a) The following have been saved on the p
                       rocess stack (by processor):
  212 00000090         ;                 xPSR, PC, LR, R12, R0-R3
  213 00000090         ;              b) Processor mode is switched to Handler 
                       mode (from Thread mode)
  214 00000090         ;              c) Stack is Main stack (switched from Pro
                       cess stack)
  215 00000090         ;              d) OSTCBCur      points to the OS_TCB of 
                       the task to suspend
  216 00000090         ;                 OSTCBHighRdy  points to the OS_TCB of 
                       the task to resume
  217 00000090         ;
  218 00000090         ;           4) Since PendSV is set to lowest priority in
                        the system (by OSStartHighRdy() above), we
  219 00000090         ;              know that it will only be run when no oth
                       er exception or interrupt is active, and
  220 00000090         ;              therefore safe to assume that context bei
                       ng switched out was using the process stack (PSP).
  221 00000090         ;
  222 00000090         ;           5) Increasing priority using a write to BASE
                       PRI does not take effect immediately.
  223 00000090         ;              (a) IMPLICATION  This erratum means that 
                       the instruction after an MSR to boost BASEPRI
  224 00000090         ;                  might incorrectly be preempted by an 
                       insufficient high priority exception.
  225 00000090         ;
  226 00000090         ;              (b) WORKAROUND  The MSR to boost BASEPRI 
                       can be replaced by the following code sequence:
  227 00000090         ;
  228 00000090         ;                  CPSID i
  229 00000090         ;                  MSR to BASEPRI
  230 00000090         ;                  DSB
  231 00000090         ;                  ISB
  232 00000090         ;                  CPSIE i
  233 00000090         ;*******************************************************
                       *************************************************
  234 00000090         
  235 00000090         PendSV_Handler
  236 00000090         ;CPSID   I                                              
                            ; Cortex-M7 errata notice. See Note #5



ARM Macro Assembler    Page 7 


  237 00000090         ;MOV32   R2, OS_KA_BASEPRI_Boundary                     
                            ; Set BASEPRI priority level required for exception
                        preemption
  238 00000090         ;LDR     R1, [R2]
  239 00000090         ;MSR     BASEPRI, R1
  240 00000090         ;DSB
  241 00000090         ;ISB
  242 00000090         ;CPSIE   I
  243 00000090         
  244 00000090 F3EF 8009       MRS              R0, PSP     ; PSP is process st
                                                            ack pointer
  245 00000094 E920 4FF0       STMFD            R0!, {R4-R11, R14} ; Save remai
                                                            ning regs r4-11, R1
                                                            4 on process stack
  246 00000098         
  247 00000098 4D39            LDR              R5, =OSTCBCur ; OSTCBCur->OSTCB
                                                            StkPtr = SP;
  248 0000009A 6829            LDR              R1, [R5]
  249 0000009C 6008            STR              R0, [R1]    ; R0 is SP of proce
                                                            ss being switched o
                                                            ut
  250 0000009E         
  251 0000009E         ; At this point, entire context of process has been save
                       d
  252 0000009E 4674            MOV              R4, LR      ; Save LR exc_retur
                                                            n value
  253 000000A0 F7FF FFFE       BL               OSTaskSwHook ; Call OSTaskSwHoo
                                                            k() for FPU Push & 
                                                            Pop
  254 000000A4         
  255 000000A4 4834            LDR              R0, =OSPrioCur ; OSPrioCur = OS
                                                            PrioHighRdy;
  256 000000A6 4935            LDR              R1, =OSPrioHighRdy
  257 000000A8 780A            LDRB             R2, [R1]
  258 000000AA 7002            STRB             R2, [R0]
  259 000000AC         
  260 000000AC 4935            LDR              R1, =OSTCBHighRdy ; OSTCBCur  =
                                                             OSTCBHighRdy;
  261 000000AE 680A            LDR              R2, [R1]
  262 000000B0 602A            STR              R2, [R5]
  263 000000B2         
  264 000000B2 F044 0E04       ORR              LR,  R4, #0x04 ; Ensure excepti
                                                            on return uses proc
                                                            ess stack
  265 000000B6 6810            LDR              R0,  [R2]   ; R0 is new process
                                                             SP; SP = OSTCBHigh
                                                            Rdy->OSTCBStkPtr;
  266 000000B8 E8B0 4FF0       LDMFD            R0!, {R4-R11, R14} ; Restore r4
                                                            -11, R14 from new p
                                                            rocess stack
  267 000000BC F380 8809       MSR              PSP, R0     ; Load PSP with new
                                                             process SP
  268 000000C0         
  269 000000C0 F240 0200 
              F2C0 0200        MOV32            R2, #0      ; Restore BASEPRI p
                                                            riority level to 0
  270 000000C8 B672            CPSID            I
  271 000000CA F382 8811       MSR              BASEPRI, R2
  272 000000CE F3BF 8F4F       DSB



ARM Macro Assembler    Page 8 


  273 000000D2 F3BF 8F6F       ISB
  274 000000D6 B662            CPSIE            I
  275 000000D8 4770            BX               LR          ; Exception return 
                                                            will restore remain
                                                            ing context 
  276 000000DA         
  277 000000DA 40023800 
                       RCC_BASE
                               EQU              0x40023800
  278 000000DA 40023800 
                       RCC_CR  EQU              RCC_BASE + 0x00
  279 000000DA 40023804 
                       RCC_PLLCFGR
                               EQU              RCC_BASE + 0x04
  280 000000DA 40023808 
                       RCC_CFGR
                               EQU              RCC_BASE + 0x08
  281 000000DA 40023830 
                       RCC_AHB1ENR
                               EQU              RCC_BASE + 0x30
  282 000000DA 40023C00 
                       FLASH_ACR
                               EQU              0x40023C00
  283 000000DA E000E010 
                       SYSTICK_BASE
                               EQU              0xE000E010
  284 000000DA E000E010 
                       SYSTICK_CTRL
                               EQU              SYSTICK_BASE + 0x00
  285 000000DA E000E014 
                       SYSTICK_LOAD
                               EQU              SYSTICK_BASE + 0x04
  286 000000DA E000E018 
                       SYSTICK_VAL
                               EQU              SYSTICK_BASE + 0x08
  287 000000DA         
  288 000000DA E000ED20 
                       SCB_SHPR3
                               EQU              0xE000ED20
  289 000000DA         
  290 000000DA         SystemInit
  291 000000DA 482C            LDR              R0, =RCC_CR
  292 000000DC 6801            LDR              R1, [R0]    ; ¶ÁÈ¡µ±Ç°RCC_CRµÄÖ
                                                            µ
  293 000000DE F441 21A0       ORR              R1, R1, #(1 << 16) :or: (1 << 1
8) 
                                                            ; ÆôÓÃHSEON£¨²»Çå³ý
                                                            ÆäËûÎ»£©
  294 000000E2         ; ÈôÊ¹ÓÃÍâ²¿Ê±ÖÓÔ´£¬Ìí¼Ó£ºORR R1, R1, #(1 << 18) ; ·ñÔò×
                       ¢ÊÍ´ËÐÐ
  295 000000E2 6001            STR              R1, [R0]
  296 000000E4         
  297 000000E4         Wait_HSE_Ready
  298 000000E4 6801            LDR              R1, [R0]
  299 000000E6 F411 3F00       TST              R1, #(1 << 17)
  300 000000EA D0FB            BEQ              Wait_HSE_Ready
  301 000000EC         
  302 000000EC         ;---------------------------------------------
  303 000000EC         ; 2. 



ARM Macro Assembler    Page 9 


  304 000000EC         ;---------------------------------------------
  305 000000EC 4828            LDR              R0, =FLASH_ACR
  306 000000EE F04F 0102       MOV              R1, #0x02
  307 000000F2 6001            STR              R1, [R0]
  308 000000F4         
  309 000000F4         ;---------------------------------------------
  310 000000F4         ; 3. 
  311 000000F4         ;---------------------------------------------
  312 000000F4 4827            LDR              R0, =RCC_PLLCFGR
  313 000000F6 F04F 0100       MOV              R1, #0x00000000
  314 000000FA F041 0108       ORR              R1, R1, #(8 << 0) ; PLLM = 16 (
                                                            bits 5:0)
  315 000000FE F441 41A8       ORR              R1, R1, #(336 << 6) ; PLLN = 33
                                                            6 (bits 14:6)
  316 00000102 F441 3180       ORR              R1, R1, #(1<< 16) 
                                                            ; PLLP = 0b00 
  317 00000106 F441 0180       ORR              R1, R1, #(1 << 22) 
                                                            ; PLLSRC = 1 
  318 0000010A 6001            STR              R1, [R0]
  319 0000010C         
  320 0000010C         ;---------------------------------------------
  321 0000010C         ; 4. 
  322 0000010C         ;---------------------------------------------
  323 0000010C 481F            LDR              R0, =RCC_CR
  324 0000010E 6801            LDR              R1, [R0]
  325 00000110 F041 7180       ORR              R1, R1, #(1 << 24)
  326 00000114 6001            STR              R1, [R0]
  327 00000116         
  328 00000116         Wait_PLL_Ready
  329 00000116 6801            LDR              R1, [R0]
  330 00000118 F011 7F00       TST              R1, #(1 << 25)
  331 0000011C D0FB            BEQ              Wait_PLL_Ready
  332 0000011E         
  333 0000011E         ;---------------------------------------------
  334 0000011E         ; 5. 
  335 0000011E         ;---------------------------------------------
  336 0000011E 481E            LDR              R0, =RCC_CFGR
  337 00000120 F04F 0100       MOV              R1, #0x00000000
  338 00000124 F041 0100       ORR              R1, R1, #(0 << 4) ; HPRE=0 
  339 00000128 F441 5180       ORR              R1, R1, #(0x4 << 10) 
                                                            ; PPRE1=0b100 
  340 0000012C F041 0100       ORR              R1, R1, #(0 << 13) ; PPRE2=0 
  341 00000130 F041 0102       ORR              R1, R1, #(2 << 0) ; SW=0b10 
  342 00000134 6001            STR              R1, [R0]
  343 00000136         
  344 00000136         Wait_Clock_Switch
  345 00000136 6801            LDR              R1, [R0]
  346 00000138 F001 020C       AND              R2, R1, #0xC
  347 0000013C 2A08            CMP              R2, #0x8
  348 0000013E D1FA            BNE              Wait_Clock_Switch
  349 00000140         
  350 00000140         ;---------------------------------------------
  351 00000140         ; 6. 
  352 00000140         ;---------------------------------------------
  353 00000140         
  354 00000140 4816            LDR              R0, =0xE000E010
  355 00000142 F04F 0100       MOV              R1, #0x00000000
  356 00000146 F041 0105       ORR              R1, #5
  357 0000014A 6001            STR              R1, [R0]



ARM Macro Assembler    Page 10 


  358 0000014C         
  359 0000014C 4813            LDR              R0, =SYSTICK_BASE
  360 0000014E 4914            LDR              R1, =83999
  361 00000150 6041            STR              R1, [R0, #0x04]
  362 00000152 F04F 0100       MOV              R1, #0
  363 00000156 6081            STR              R1, [R0, #0x08]
  364 00000158 F04F 0107       MOV              R1, #0x07
  365 0000015C 6001            STR              R1, [R0, #0x00]
  366 0000015E         
  367 0000015E 4811            LDR              R0,=SCB_SHPR3
  368 00000160 F041 61A0       ORR              R1, #(0x5 << 24)
  369 00000164 6001            STR              R1, [R0]
  370 00000166         
  371 00000166 B662            CPSIE            I
  372 00000168         
  373 00000168 4770            BX               LR
  374 0000016A         
  375 0000016A 00 00           ALIGN                        ; Removes warning[A
                                                            1581W]: added <no_p
                                                            adbytes> of padding
                                                             at <address>
  376 0000016C         
  377 0000016C                 END
              E000ED22 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              E000ED04 
              40023800 
              40023C00 
              40023804 
              40023808 
              E000E010 
              0001481F 
              E000ED20 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M4.fp --apcs=int
erwork --depend=.\objects\os_cpu_a.d -o.\objects\os_cpu_a.o -I.\RTE\_Target_1 -
IC:\Keil_v5\ARM\PACK\Keil\STM32F4xx_DFP\2.17.0\Drivers\CMSIS\Device\ST\STM32F4x
x\Include -IC:\Keil_v5\ARM\CMSIS\Include --predefine="__UVISION_VERSION SETA 52
4" --predefine="STM32F401xE SETA 1" --list=.\listings\os_cpu_a.lst ..\Port\os_c
pu_a.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

.text 00000000

Symbol: .text
   Definitions
      At line 30 in file ..\Port\os_cpu_a.s
   Uses
      None
Comment: .text unused
OSCtxSw 00000086

Symbol: OSCtxSw
   Definitions
      At line 179 in file ..\Port\os_cpu_a.s
   Uses
      At line 14 in file ..\Port\os_cpu_a.s
Comment: OSCtxSw used once
OSIntCtxSw 00000086

Symbol: OSIntCtxSw
   Definitions
      At line 180 in file ..\Port\os_cpu_a.s
   Uses
      At line 15 in file ..\Port\os_cpu_a.s
Comment: OSIntCtxSw used once
OSStartHighRdy 0000002E

Symbol: OSStartHighRdy
   Definitions
      At line 122 in file ..\Port\os_cpu_a.s
   Uses
      At line 16 in file ..\Port\os_cpu_a.s
Comment: OSStartHighRdy used once
OS_CPU_SR_Restore 0000001C

Symbol: OS_CPU_SR_Restore
   Definitions
      At line 91 in file ..\Port\os_cpu_a.s
   Uses
      At line 13 in file ..\Port\os_cpu_a.s
Comment: OS_CPU_SR_Restore used once
OS_CPU_SR_Save 00000000

Symbol: OS_CPU_SR_Save
   Definitions
      At line 79 in file ..\Port\os_cpu_a.s
   Uses
      At line 12 in file ..\Port\os_cpu_a.s
Comment: OS_CPU_SR_Save used once
PendSV_Handler 00000090

Symbol: PendSV_Handler
   Definitions
      At line 235 in file ..\Port\os_cpu_a.s
   Uses
      At line 17 in file ..\Port\os_cpu_a.s
Comment: PendSV_Handler used once
SystemInit 000000DA

Symbol: SystemInit



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 290 in file ..\Port\os_cpu_a.s
   Uses
      At line 18 in file ..\Port\os_cpu_a.s
Comment: SystemInit used once
Wait_Clock_Switch 00000136

Symbol: Wait_Clock_Switch
   Definitions
      At line 344 in file ..\Port\os_cpu_a.s
   Uses
      At line 348 in file ..\Port\os_cpu_a.s
Comment: Wait_Clock_Switch used once
Wait_HSE_Ready 000000E4

Symbol: Wait_HSE_Ready
   Definitions
      At line 297 in file ..\Port\os_cpu_a.s
   Uses
      At line 300 in file ..\Port\os_cpu_a.s
Comment: Wait_HSE_Ready used once
Wait_PLL_Ready 00000116

Symbol: Wait_PLL_Ready
   Definitions
      At line 328 in file ..\Port\os_cpu_a.s
   Uses
      At line 331 in file ..\Port\os_cpu_a.s
Comment: Wait_PLL_Ready used once
11 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

FLASH_ACR 40023C00

Symbol: FLASH_ACR
   Definitions
      At line 282 in file ..\Port\os_cpu_a.s
   Uses
      At line 305 in file ..\Port\os_cpu_a.s
Comment: FLASH_ACR used once
NVIC_INT_CTRL E000ED04

Symbol: NVIC_INT_CTRL
   Definitions
      At line 24 in file ..\Port\os_cpu_a.s
   Uses
      At line 182 in file ..\Port\os_cpu_a.s
Comment: NVIC_INT_CTRL used once
NVIC_PENDSVSET 10000000

Symbol: NVIC_PENDSVSET
   Definitions
      At line 27 in file ..\Port\os_cpu_a.s
   Uses
      At line 183 in file ..\Port\os_cpu_a.s
Comment: NVIC_PENDSVSET used once
NVIC_PENDSV_PRI 000000FF

Symbol: NVIC_PENDSV_PRI
   Definitions
      At line 26 in file ..\Port\os_cpu_a.s
   Uses
      At line 125 in file ..\Port\os_cpu_a.s
Comment: NVIC_PENDSV_PRI used once
NVIC_SYSPRI14 E000ED22

Symbol: NVIC_SYSPRI14
   Definitions
      At line 25 in file ..\Port\os_cpu_a.s
   Uses
      At line 124 in file ..\Port\os_cpu_a.s
Comment: NVIC_SYSPRI14 used once
RCC_AHB1ENR 40023830

Symbol: RCC_AHB1ENR
   Definitions
      At line 281 in file ..\Port\os_cpu_a.s
   Uses
      None
Comment: RCC_AHB1ENR unused
RCC_BASE 40023800

Symbol: RCC_BASE
   Definitions
      At line 277 in file ..\Port\os_cpu_a.s
   Uses
      At line 278 in file ..\Port\os_cpu_a.s
      At line 279 in file ..\Port\os_cpu_a.s
      At line 280 in file ..\Port\os_cpu_a.s
      At line 281 in file ..\Port\os_cpu_a.s




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

RCC_CFGR 40023808

Symbol: RCC_CFGR
   Definitions
      At line 280 in file ..\Port\os_cpu_a.s
   Uses
      At line 336 in file ..\Port\os_cpu_a.s
Comment: RCC_CFGR used once
RCC_CR 40023800

Symbol: RCC_CR
   Definitions
      At line 278 in file ..\Port\os_cpu_a.s
   Uses
      At line 291 in file ..\Port\os_cpu_a.s
      At line 323 in file ..\Port\os_cpu_a.s

RCC_PLLCFGR 40023804

Symbol: RCC_PLLCFGR
   Definitions
      At line 279 in file ..\Port\os_cpu_a.s
   Uses
      At line 312 in file ..\Port\os_cpu_a.s
Comment: RCC_PLLCFGR used once
SCB_SHPR3 E000ED20

Symbol: SCB_SHPR3
   Definitions
      At line 288 in file ..\Port\os_cpu_a.s
   Uses
      At line 367 in file ..\Port\os_cpu_a.s
Comment: SCB_SHPR3 used once
SYSTICK_BASE E000E010

Symbol: SYSTICK_BASE
   Definitions
      At line 283 in file ..\Port\os_cpu_a.s
   Uses
      At line 284 in file ..\Port\os_cpu_a.s
      At line 285 in file ..\Port\os_cpu_a.s
      At line 286 in file ..\Port\os_cpu_a.s
      At line 359 in file ..\Port\os_cpu_a.s

SYSTICK_CTRL E000E010

Symbol: SYSTICK_CTRL
   Definitions
      At line 284 in file ..\Port\os_cpu_a.s
   Uses
      None
Comment: SYSTICK_CTRL unused
SYSTICK_LOAD E000E014

Symbol: SYSTICK_LOAD
   Definitions
      At line 285 in file ..\Port\os_cpu_a.s
   Uses
      None



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Absolute symbols

Comment: SYSTICK_LOAD unused
SYSTICK_VAL E000E018

Symbol: SYSTICK_VAL
   Definitions
      At line 286 in file ..\Port\os_cpu_a.s
   Uses
      None
Comment: SYSTICK_VAL unused
15 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

OSIntExit 00000000

Symbol: OSIntExit
   Definitions
      At line 7 in file ..\Port\os_cpu_a.s
   Uses
      None
Comment: OSIntExit unused
OSPrioCur 00000000

Symbol: OSPrioCur
   Definitions
      At line 3 in file ..\Port\os_cpu_a.s
   Uses
      At line 141 in file ..\Port\os_cpu_a.s
      At line 255 in file ..\Port\os_cpu_a.s

OSPrioHighRdy 00000000

Symbol: OSPrioHighRdy
   Definitions
      At line 4 in file ..\Port\os_cpu_a.s
   Uses
      At line 142 in file ..\Port\os_cpu_a.s
      At line 256 in file ..\Port\os_cpu_a.s

OSRunning 00000000

Symbol: OSRunning
   Definitions
      At line 2 in file ..\Port\os_cpu_a.s
   Uses
      At line 137 in file ..\Port\os_cpu_a.s
Comment: OSRunning used once
OSTCBCur 00000000

Symbol: OSTCBCur
   Definitions
      At line 5 in file ..\Port\os_cpu_a.s
   Uses
      At line 146 in file ..\Port\os_cpu_a.s
      At line 247 in file ..\Port\os_cpu_a.s

OSTCBHighRdy 00000000

Symbol: OSTCBHighRdy
   Definitions
      At line 6 in file ..\Port\os_cpu_a.s
   Uses
      At line 147 in file ..\Port\os_cpu_a.s
      At line 260 in file ..\Port\os_cpu_a.s

OSTaskSwHook 00000000

Symbol: OSTaskSwHook
   Definitions
      At line 8 in file ..\Port\os_cpu_a.s
   Uses
      At line 135 in file ..\Port\os_cpu_a.s



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
External symbols

      At line 253 in file ..\Port\os_cpu_a.s

OS_CPU_ExceptStkBase 00000000

Symbol: OS_CPU_ExceptStkBase
   Definitions
      At line 9 in file ..\Port\os_cpu_a.s
   Uses
      At line 131 in file ..\Port\os_cpu_a.s
Comment: OS_CPU_ExceptStkBase used once
OS_KA_BASEPRI_Boundary 00000000

Symbol: OS_KA_BASEPRI_Boundary
   Definitions
      At line 10 in file ..\Port\os_cpu_a.s
   Uses
      None
Comment: OS_KA_BASEPRI_Boundary unused
9 symbols
370 symbols in table
