


ARM Macro Assembler    Page 1 


    1 00000000                 EXTERN           OSRunning   ; External referenc
                                                            es
    2 00000000                 EXTERN           OSPrioCur
    3 00000000                 EXTERN           OSPrioHighRdy
    4 00000000                 EXTERN           OSTCBCur
    5 00000000                 EXTERN           OSTCBHighRdy
    6 00000000                 EXTERN           OSIntExit
    7 00000000                 EXTERN           OSTaskSwHook
    8 00000000                 EXTERN           OS_CPU_ExceptStkBase
    9 00000000                 EXTERN           OS_KA_BASEPRI_Boundary
   10 00000000         
   11 00000000                 EXPORT           OS_CPU_SR_Save
   12 00000000                 EXPORT           OS_CPU_SR_Restore
   13 00000000                 EXPORT           OSCtxSw
   14 00000000                 EXPORT           OSIntCtxSw
   15 00000000                 EXPORT           OSStartHighRdy
   16 00000000                 EXPORT           PendSV_Handler
   17 00000000                 EXPORT           SystemInit
   18 00000000         
   19 00000000         ;*******************************************************
                       *************************************************
   20 00000000         ;                                               EQUATES
   21 00000000         ;*******************************************************
                       *************************************************
   22 00000000         
   23 00000000 E000ED04 
                       NVIC_INT_CTRL
                               EQU              0xE000ED04  ; Interrupt control
                                                             state register.
   24 00000000 E000ED22 
                       NVIC_SYSPRI14
                               EQU              0xE000ED22  ; System priority r
                                                            egister (priority 1
                                                            4).
   25 00000000 000000FF 
                       NVIC_PENDSV_PRI
                               EQU              0xFF        ; PendSV priority v
                                                            alue (lowest).
   26 00000000 10000000 
                       NVIC_PENDSVSET
                               EQU              0x10000000  ; Value to trigger 
                                                            PendSV exception.
   27 00000000         
   28 00000000         
   29 00000000                 AREA             |.text|, CODE, READONLY, ALIGN=
2
   30 00000000                 THUMB
   31 00000000                 REQUIRE8
   32 00000000                 PRESERVE8
   33 00000000         
   34 00000000         ;*******************************************************
                       *************************************************
   35 00000000         ;                                   CRITICAL SECTION MET
                       HOD 3 FUNCTIONS
   36 00000000         ;
   37 00000000         ; Description : Disable/Enable Kernel aware interrupts b
                       y preserving the state of BASEPRI.  Generally speaking,
   38 00000000         ;               the state of the BASEPRI interrupt excep
                       tion processing is stored in the local variable



ARM Macro Assembler    Page 2 


   39 00000000         ;               'cpu_sr' & Kernel Aware interrupts are t
                       hen disabled ('cpu_sr' is allocated in all functions
   40 00000000         ;               that need to disable Kernel aware interr
                       upts). The previous BASEPRI interrupt state is restored
   41 00000000         ;               by copying 'cpu_sr' into the BASEPRI reg
                       ister.
   42 00000000         ;
   43 00000000         ; Prototypes  : OS_CPU_SR  OS_CPU_SR_Save   (OS_CPU_SR  
                       new_basepri);
   44 00000000         ;               void       OS_CPU_SR_Restore(OS_CPU_SR  
                       cpu_sr);
   45 00000000         ;
   46 00000000         ;
   47 00000000         ; Note(s)     : 1) These functions are used in general l
                       ike this:
   48 00000000         ;
   49 00000000         ;                  void Task (void *p_arg)
   50 00000000         ;                  {
   51 00000000         ;                  #if OS_CRITICAL_METHOD == 3          
                       /* Allocate storage for CPU status register  */
   52 00000000         ;                      OS_CPU_SR  cpu_sr;
   53 00000000         ;                  #endif
   54 00000000         ;
   55 00000000         ;                          :
   56 00000000         ;                          :
   57 00000000         ;                      OS_ENTER_CRITICAL();             
                       /* cpu_sr = OS_CPU_SR_Save(new_basepri);     */
   58 00000000         ;                          :
   59 00000000         ;                          :
   60 00000000         ;                      OS_EXIT_CRITICAL();              
                       /* OS_CPU_RestoreSR(cpu_sr);                 */
   61 00000000         ;                          :
   62 00000000         ;                          :
   63 00000000         ;                  }
   64 00000000         ;
   65 00000000         ;               2) Increasing priority using a write to 
                       BASEPRI does not take effect immediately.
   66 00000000         ;                  (a) IMPLICATION  This erratum means t
                       hat the instruction after an MSR to boost BASEPRI
   67 00000000         ;                      might incorrectly be preempted by
                        an insufficient high priority exception.
   68 00000000         ;
   69 00000000         ;                  (b) WORKAROUND  The MSR to boost BASE
                       PRI can be replaced by the following code sequence:
   70 00000000         ;
   71 00000000         ;                      CPSID i
   72 00000000         ;                      MSR to BASEPRI
   73 00000000         ;                      DSB
   74 00000000         ;                      ISB
   75 00000000         ;                      CPSIE i
   76 00000000         ;*******************************************************
                       *************************************************
   77 00000000         
   78 00000000         OS_CPU_SR_Save
   79 00000000 B672            CPSID            I           ; Cortex-M7 errata 
                                                            notice. See Note #2
                                                            
   80 00000002 B402            PUSH             {R1}
   81 00000004 F3EF 8111       MRS              R1, BASEPRI



ARM Macro Assembler    Page 3 


   82 00000008 F380 8811       MSR              BASEPRI, R0
   83 0000000C F3BF 8F4F       DSB
   84 00000010 F3BF 8F6F       ISB
   85 00000014 4608            MOV              R0, R1
   86 00000016 BC02            POP              {R1}
   87 00000018 B662            CPSIE            I
   88 0000001A 4770            BX               LR
   89 0000001C         
   90 0000001C         OS_CPU_SR_Restore
   91 0000001C B672            CPSID            I           ; Cortex-M7 errata 
                                                            notice. See Note #2
                                                            
   92 0000001E F380 8811       MSR              BASEPRI, R0
   93 00000022 F3BF 8F4F       DSB
   94 00000026 F3BF 8F6F       ISB
   95 0000002A B662            CPSIE            I
   96 0000002C 4770            BX               LR
   97 0000002E         
   98 0000002E         
   99 0000002E         ;*******************************************************
                       *************************************************
  100 0000002E         ;                                         START MULTITAS
                       KING
  101 0000002E         ;                                      void OSStartHighR
                       dy(void)
  102 0000002E         ;
  103 0000002E         ; Note(s) : 1) This function triggers a PendSV exception
                        (essentially, causes a context switch) to cause
  104 0000002E         ;              the first task to start.
  105 0000002E         ;
  106 0000002E         ;           2) During task execution, PSP is used as the
                        stack pointer.
  107 0000002E         ;              When an exception occurs, the core will s
                       witch to MSP until the exception return.
  108 0000002E         ;
  109 0000002E         ;           3) OSStartHighRdy() MUST:
  110 0000002E         ;              a) Setup PendSV exception priority to low
                       est;
  111 0000002E         ;              b) Set initial PSP to 0, to tell context 
                       switcher this is first run;
  112 0000002E         ;              c) Set the main stack to OS_CPU_ExceptStk
                       Base
  113 0000002E         ;              d) Set OSRunning to TRUE;
  114 0000002E         ;              e) Get current high priority, OSPrioCur =
                        OSPrioHighRdy;
  115 0000002E         ;              f) Get current ready thread TCB, OSTCBCur
                        = OSTCBHighRdy;
  116 0000002E         ;              g) Get new process SP from TCB, SP = OSTC
                       BHighRdy->OSTCBStkPtr;
  117 0000002E         ;              h) Restore R0-R11 and R14 from new proces
                       s stack;
  118 0000002E         ;              i) Enable interrupts (tasks will run with
                        interrupts enabled).
  119 0000002E         ;*******************************************************
                       *************************************************
  120 0000002E         
  121 0000002E         OSStartHighRdy
  122 0000002E B672            CPSID            I           ; Prevent interrupt
                                                            ion during context 



ARM Macro Assembler    Page 4 


                                                            switch
  123 00000030 484E            LDR              R0, =NVIC_SYSPRI14 ; Set the Pe
                                                            ndSV exception prio
                                                            rity
  124 00000032 F04F 01FF       LDR              R1, =NVIC_PENDSV_PRI
  125 00000036 7001            STRB             R1, [R0]
  126 00000038         
  127 00000038 2000            MOVS             R0, #0      ; Set the PSP to 0 
                                                            for initial context
                                                             switch call
  128 0000003A F380 8809       MSR              PSP, R0
  129 0000003E         
  130 0000003E 484C            LDR              R0, =OS_CPU_ExceptStkBase ; Ini
                                                            tialize the MSP to 
                                                            the OS_CPU_ExceptSt
                                                            kBase
  131 00000040 6801            LDR              R1, [R0]
  132 00000042 F381 8808       MSR              MSP, R1
  133 00000046         
  134 00000046 F7FF FFFE       BL               OSTaskSwHook ; Call OSTaskSwHoo
                                                            k() for FPU Push & 
                                                            Pop
  135 0000004A         
  136 0000004A 484A            LDR              R0, =OSRunning 
                                                            ; OSRunning = TRUE
  137 0000004C 2101            MOVS             R1, #1
  138 0000004E 7001            STRB             R1, [R0]
  139 00000050         
  140 00000050 4849            LDR              R0, =OSPrioCur ; OSPrioCur = OS
                                                            PrioHighRdy;
  141 00000052 494A            LDR              R1, =OSPrioHighRdy
  142 00000054 780A            LDRB             R2, [R1]
  143 00000056 7002            STRB             R2, [R0]
  144 00000058         
  145 00000058 4849            LDR              R0, =OSTCBCur ; OSTCBCur  = OST
                                                            CBHighRdy;
  146 0000005A 494A            LDR              R1, =OSTCBHighRdy
  147 0000005C 680A            LDR              R2, [R1]
  148 0000005E 6002            STR              R2, [R0]
  149 00000060         
  150 00000060 6810            LDR              R0, [R2]    ; R0 is new process
                                                             SP; SP = OSTCBHigh
                                                            Rdy->OSTCBStkPtr;
  151 00000062 F380 8809       MSR              PSP, R0     ; Load PSP with new
                                                             process SP
  152 00000066         
  153 00000066 F3EF 8014       MRS              R0, CONTROL
  154 0000006A F040 0002       ORR              R0, R0, #2
  155 0000006E F380 8814       MSR              CONTROL, R0
  156 00000072 F3BF 8F6F       ISB                          ; Sync instruction 
                                                            stream
  157 00000076         
  158 00000076 E8BD 4FF0       LDMFD            SP!, {R4-R11, LR} ; Restore r4-
                                                            11, lr from new pro
                                                            cess stack
  159 0000007A BC0F            LDMFD            SP!, {R0-R3} ; Restore r0, r3
  160 0000007C E8BD 5000       LDMFD            SP!, {R12, LR} 
                                                            ; Load R12 and LR
  161 00000080 BC06            LDMFD            SP!, {R1, R2} ; Load PC and dis



ARM Macro Assembler    Page 5 


                                                            card xPSR
  162 00000082 B662            CPSIE            I
  163 00000084 4708            BX               R1
  164 00000086         
  165 00000086         
  166 00000086         ;*******************************************************
                       *************************************************
  167 00000086         ;                       PERFORM A CONTEXT SWITCH (From t
                       ask level) - OSCtxSw()
  168 00000086         ;                   PERFORM A CONTEXT SWITCH (From inter
                       rupt level) - OSIntCtxSw()
  169 00000086         ;
  170 00000086         ; Note(s) : 1) OSCtxSw() is called when OS wants to perf
                       orm a task context switch.  This function
  171 00000086         ;              triggers the PendSV exception which is wh
                       ere the real work is done.
  172 00000086         ;
  173 00000086         ;           2) OSIntCtxSw() is called by OSIntExit() whe
                       n it determines a context switch is needed as
  174 00000086         ;              the result of an interrupt.  This functio
                       n simply triggers a PendSV exception which will
  175 00000086         ;              be handled when there are no more interru
                       pts active and interrupts are enabled.
  176 00000086         ;*******************************************************
                       *************************************************
  177 00000086         
  178 00000086         OSCtxSw
  179 00000086         OSIntCtxSw
  180 00000086         
  181 00000086 4840            LDR              R0, =NVIC_INT_CTRL ; Trigger th
                                                            e PendSV exception 
                                                            (causes context swi
                                                            tch)
  182 00000088 F04F 5180       LDR              R1, =NVIC_PENDSVSET
  183 0000008C 6001            STR              R1, [R0]
  184 0000008E 4770            BX               LR
  185 00000090         
  186 00000090         
  187 00000090         ;*******************************************************
                       *************************************************
  188 00000090         ;                                       HANDLE PendSV EX
                       CEPTION
  189 00000090         ;                                   void OS_CPU_PendSVHa
                       ndler(void)
  190 00000090         ;
  191 00000090         ; Note(s) : 1) PendSV is used to cause a context switch.
                         This is a recommended method for performing
  192 00000090         ;              context switches with Cortex-M.  This is 
                       because the Cortex-M auto-saves half of the
  193 00000090         ;              processor context on any exception, and r
                       estores same on return from exception.  So only
  194 00000090         ;              saving of R4-R11 & R14 is required and fi
                       xing up the stack pointers. Using the PendSV exception
  195 00000090         ;              this way means that context saving and re
                       storing is identical whether it is initiated from
  196 00000090         ;              a thread or occurs due to an interrupt or
                        exception.
  197 00000090         ;
  198 00000090         ;           2) Pseudo-code is:



ARM Macro Assembler    Page 6 


  199 00000090         ;              a) Get the process SP
  200 00000090         ;              b) Save remaining regs r4-r11 & r14 on pr
                       ocess stack;
  201 00000090         ;              c) Save the process SP in its TCB, OSTCBC
                       ur->OSTCBStkPtr = SP;
  202 00000090         ;              d) Call OSTaskSwHook();
  203 00000090         ;              e) Get current high priority, OSPrioCur =
                        OSPrioHighRdy;
  204 00000090         ;              f) Get current ready thread TCB, OSTCBCur
                        = OSTCBHighRdy;
  205 00000090         ;              g) Get new process SP from TCB, SP = OSTC
                       BHighRdy->OSTCBStkPtr;
  206 00000090         ;              h) Restore R4-R11 and R14 from new proces
                       s stack;
  207 00000090         ;              i) Perform exception return which will re
                       store remaining context.
  208 00000090         ;
  209 00000090         ;           3) On entry into PendSV handler:
  210 00000090         ;              a) The following have been saved on the p
                       rocess stack (by processor):
  211 00000090         ;                 xPSR, PC, LR, R12, R0-R3
  212 00000090         ;              b) Processor mode is switched to Handler 
                       mode (from Thread mode)
  213 00000090         ;              c) Stack is Main stack (switched from Pro
                       cess stack)
  214 00000090         ;              d) OSTCBCur      points to the OS_TCB of 
                       the task to suspend
  215 00000090         ;                 OSTCBHighRdy  points to the OS_TCB of 
                       the task to resume
  216 00000090         ;
  217 00000090         ;           4) Since PendSV is set to lowest priority in
                        the system (by OSStartHighRdy() above), we
  218 00000090         ;              know that it will only be run when no oth
                       er exception or interrupt is active, and
  219 00000090         ;              therefore safe to assume that context bei
                       ng switched out was using the process stack (PSP).
  220 00000090         ;
  221 00000090         ;           5) Increasing priority using a write to BASE
                       PRI does not take effect immediately.
  222 00000090         ;              (a) IMPLICATION  This erratum means that 
                       the instruction after an MSR to boost BASEPRI
  223 00000090         ;                  might incorrectly be preempted by an 
                       insufficient high priority exception.
  224 00000090         ;
  225 00000090         ;              (b) WORKAROUND  The MSR to boost BASEPRI 
                       can be replaced by the following code sequence:
  226 00000090         ;
  227 00000090         ;                  CPSID i
  228 00000090         ;                  MSR to BASEPRI
  229 00000090         ;                  DSB
  230 00000090         ;                  ISB
  231 00000090         ;                  CPSIE i
  232 00000090         ;*******************************************************
                       *************************************************
  233 00000090         
  234 00000090         PendSV_Handler
  235 00000090         ;CPSID   I                                              
                            ; Cortex-M7 errata notice. See Note #5
  236 00000090         ;MOV32   R2, OS_KA_BASEPRI_Boundary                     



ARM Macro Assembler    Page 7 


                            ; Set BASEPRI priority level required for exception
                        preemption
  237 00000090         ;LDR     R1, [R2]
  238 00000090         ;MSR     BASEPRI, R1
  239 00000090         ;DSB
  240 00000090         ;ISB
  241 00000090         ;CPSIE   I
  242 00000090         
  243 00000090 F3EF 8009       MRS              R0, PSP     ; PSP is process st
                                                            ack pointer
  244 00000094 E920 4FF0       STMFD            R0!, {R4-R11, R14} ; Save remai
                                                            ning regs r4-11, R1
                                                            4 on process stack
  245 00000098         
  246 00000098 4D39            LDR              R5, =OSTCBCur ; OSTCBCur->OSTCB
                                                            StkPtr = SP;
  247 0000009A 6829            LDR              R1, [R5]
  248 0000009C 6008            STR              R0, [R1]    ; R0 is SP of proce
                                                            ss being switched o
                                                            ut
  249 0000009E         
  250 0000009E         ; At this point, entire context of process has been save
                       d
  251 0000009E 4674            MOV              R4, LR      ; Save LR exc_retur
                                                            n value
  252 000000A0 F7FF FFFE       BL               OSTaskSwHook ; Call OSTaskSwHoo
                                                            k() for FPU Push & 
                                                            Pop
  253 000000A4         
  254 000000A4 4834            LDR              R0, =OSPrioCur ; OSPrioCur = OS
                                                            PrioHighRdy;
  255 000000A6 4935            LDR              R1, =OSPrioHighRdy
  256 000000A8 780A            LDRB             R2, [R1]
  257 000000AA 7002            STRB             R2, [R0]
  258 000000AC         
  259 000000AC 4935            LDR              R1, =OSTCBHighRdy ; OSTCBCur  =
                                                             OSTCBHighRdy;
  260 000000AE 680A            LDR              R2, [R1]
  261 000000B0 602A            STR              R2, [R5]
  262 000000B2         
  263 000000B2 F044 0E04       ORR              LR,  R4, #0x04 ; Ensure excepti
                                                            on return uses proc
                                                            ess stack
  264 000000B6 6810            LDR              R0,  [R2]   ; R0 is new process
                                                             SP; SP = OSTCBHigh
                                                            Rdy->OSTCBStkPtr;
  265 000000B8 E8B0 4FF0       LDMFD            R0!, {R4-R11, R14} ; Restore r4
                                                            -11, R14 from new p
                                                            rocess stack
  266 000000BC F380 8809       MSR              PSP, R0     ; Load PSP with new
                                                             process SP
  267 000000C0         
  268 000000C0 F240 0200 
              F2C0 0200        MOV32            R2, #0      ; Restore BASEPRI p
                                                            riority level to 0
  269 000000C8 B672            CPSID            I
  270 000000CA F382 8811       MSR              BASEPRI, R2
  271 000000CE F3BF 8F4F       DSB
  272 000000D2 F3BF 8F6F       ISB



ARM Macro Assembler    Page 8 


  273 000000D6 B662            CPSIE            I
  274 000000D8 4770            BX               LR          ; Exception return 
                                                            will restore remain
                                                            ing context
  275 000000DA         
  276 000000DA 40023800 
                       RCC_BASE
                               EQU              0x40023800
  277 000000DA 40023800 
                       RCC_CR  EQU              RCC_BASE + 0x00
  278 000000DA 40023804 
                       RCC_PLLCFGR
                               EQU              RCC_BASE + 0x04
  279 000000DA 40023808 
                       RCC_CFGR
                               EQU              RCC_BASE + 0x08
  280 000000DA 40023830 
                       RCC_AHB1ENR
                               EQU              RCC_BASE + 0x30
  281 000000DA 40023C00 
                       FLASH_ACR
                               EQU              0x40023C00
  282 000000DA E000E010 
                       SYSTICK_BASE
                               EQU              0xE000E010
  283 000000DA E000E010 
                       SYSTICK_CTRL
                               EQU              SYSTICK_BASE + 0x00
  284 000000DA E000E014 
                       SYSTICK_LOAD
                               EQU              SYSTICK_BASE + 0x04
  285 000000DA E000E018 
                       SYSTICK_VAL
                               EQU              SYSTICK_BASE + 0x08
  286 000000DA         
  287 000000DA E000ED20 
                       SCB_SHPR3
                               EQU              0xE000ED20
  288 000000DA         
  289 000000DA         SystemInit
  290 000000DA 482C            LDR              R0, =RCC_CR
  291 000000DC 6801            LDR              R1, [R0]    ; ¶ÁÈ¡µ±Ç°RCC_CRµÄÖ
                                                            µ
  292 000000DE F441 21A0       ORR              R1, R1, #(1 << 16) :or: (1 << 1
8) 
                                                            ; ÆôÓÃHSEON£¨²»Çå³ý
                                                            ÆäËûÎ»£©
  293 000000E2 6001            STR              R1, [R0]
  294 000000E4         
  295 000000E4         Wait_HSE_Ready
  296 000000E4 6801            LDR              R1, [R0]
  297 000000E6 F411 3F00       TST              R1, #(1 << 17)
  298 000000EA D0FB            BEQ              Wait_HSE_Ready
  299 000000EC         
  300 000000EC         ;---------------------------------------------
  301 000000EC         ; 2. 
  302 000000EC         ;---------------------------------------------
  303 000000EC 4828            LDR              R0, =FLASH_ACR
  304 000000EE F04F 0102       MOV              R1, #0x02



ARM Macro Assembler    Page 9 


  305 000000F2 6001            STR              R1, [R0]
  306 000000F4         
  307 000000F4         ;---------------------------------------------
  308 000000F4         ; 3. 
  309 000000F4         ;---------------------------------------------
  310 000000F4 4827            LDR              R0, =RCC_PLLCFGR
  311 000000F6 F04F 0100       MOV              R1, #0x00000000
  312 000000FA F041 0108       ORR              R1, R1, #(8 << 0) ; PLLM = 16 (
                                                            bits 5:0)
  313 000000FE F441 41A8       ORR              R1, R1, #(336 << 6) ; PLLN = 33
                                                            6 (bits 14:6)
  314 00000102 F441 3180       ORR              R1, R1, #(1<< 16) 
                                                            ; PLLP = 0b00 
  315 00000106 F441 0180       ORR              R1, R1, #(1 << 22) 
                                                            ; PLLSRC = 1 
  316 0000010A 6001            STR              R1, [R0]
  317 0000010C         
  318 0000010C         ;---------------------------------------------
  319 0000010C         ; 4. 
  320 0000010C         ;---------------------------------------------
  321 0000010C 481F            LDR              R0, =RCC_CR
  322 0000010E 6801            LDR              R1, [R0]
  323 00000110 F041 7180       ORR              R1, R1, #(1 << 24)
  324 00000114 6001            STR              R1, [R0]
  325 00000116         
  326 00000116         Wait_PLL_Ready
  327 00000116 6801            LDR              R1, [R0]
  328 00000118 F011 7F00       TST              R1, #(1 << 25)
  329 0000011C D0FB            BEQ              Wait_PLL_Ready
  330 0000011E         
  331 0000011E         ;---------------------------------------------
  332 0000011E         ; 5. 
  333 0000011E         ;---------------------------------------------
  334 0000011E 481E            LDR              R0, =RCC_CFGR
  335 00000120 F04F 0100       MOV              R1, #0x00000000
  336 00000124 F041 0100       ORR              R1, R1, #(0 << 4) ; HPRE=0 
  337 00000128 F441 5180       ORR              R1, R1, #(0x4 << 10) 
                                                            ; PPRE1=0b100 
  338 0000012C F041 0100       ORR              R1, R1, #(0 << 13) ; PPRE2=0 
  339 00000130 F041 0102       ORR              R1, R1, #(2 << 0) ; SW=0b10 
  340 00000134 6001            STR              R1, [R0]
  341 00000136         
  342 00000136         Wait_Clock_Switch
  343 00000136 6801            LDR              R1, [R0]
  344 00000138 F001 020C       AND              R2, R1, #0xC
  345 0000013C 2A08            CMP              R2, #0x8
  346 0000013E D1FA            BNE              Wait_Clock_Switch
  347 00000140         
  348 00000140         ;---------------------------------------------
  349 00000140         ; 6. 
  350 00000140         ;---------------------------------------------
  351 00000140         
  352 00000140 4816            LDR              R0, =0xE000E010
  353 00000142 F04F 0100       MOV              R1, #0x00000000
  354 00000146 F041 0105       ORR              R1, #5
  355 0000014A 6001            STR              R1, [R0]
  356 0000014C         
  357 0000014C 4813            LDR              R0, =SYSTICK_BASE
  358 0000014E 4914            LDR              R1, =83999



ARM Macro Assembler    Page 10 


  359 00000150 6041            STR              R1, [R0, #0x04]
  360 00000152 F04F 0100       MOV              R1, #0
  361 00000156 6081            STR              R1, [R0, #0x08]
  362 00000158 F04F 0107       MOV              R1, #0x07
  363 0000015C 6001            STR              R1, [R0, #0x00]
  364 0000015E         
  365 0000015E 4811            LDR              R0,=SCB_SHPR3
  366 00000160 F041 61A0       ORR              R1, #(0x5 << 24)
  367 00000164 6001            STR              R1, [R0]
  368 00000166         
  369 00000166 B662            CPSIE            I
  370 00000168         
  371 00000168 4770            BX               LR
  372 0000016A         
  373 0000016A 00 00           ALIGN                        ; Removes warning[A
                                                            1581W]: added <no_p
                                                            adbytes> of padding
                                                             at <address>
  374 0000016C                 END
              E000ED22 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              E000ED04 
              40023800 
              40023C00 
              40023804 
              40023808 
              E000E010 
              0001481F 
              E000ED20 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M4.fp --apcs=int
erwork --depend=.\objects\os_cpu_a.d -o.\objects\os_cpu_a.o -I..\Cfg -I..\Core 
-I..\Port -I..\Source -I.\RTE\_Target_1 -IC:\Keil_v5\ARM\PACK\Keil\STM32F4xx_DF
P\2.17.0\Drivers\CMSIS\Device\ST\STM32F4xx\Include -IC:\Keil_v5\ARM\CMSIS\Inclu
de --predefine="__UVISION_VERSION SETA 524" --predefine="STM32F401xE SETA 1" --
list=.\listings\os_cpu_a.lst ..\Port\os_cpu_a.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

.text 00000000

Symbol: .text
   Definitions
      At line 29 in file ..\Port\os_cpu_a.s
   Uses
      None
Comment: .text unused
OSCtxSw 00000086

Symbol: OSCtxSw
   Definitions
      At line 178 in file ..\Port\os_cpu_a.s
   Uses
      At line 13 in file ..\Port\os_cpu_a.s
Comment: OSCtxSw used once
OSIntCtxSw 00000086

Symbol: OSIntCtxSw
   Definitions
      At line 179 in file ..\Port\os_cpu_a.s
   Uses
      At line 14 in file ..\Port\os_cpu_a.s
Comment: OSIntCtxSw used once
OSStartHighRdy 0000002E

Symbol: OSStartHighRdy
   Definitions
      At line 121 in file ..\Port\os_cpu_a.s
   Uses
      At line 15 in file ..\Port\os_cpu_a.s
Comment: OSStartHighRdy used once
OS_CPU_SR_Restore 0000001C

Symbol: OS_CPU_SR_Restore
   Definitions
      At line 90 in file ..\Port\os_cpu_a.s
   Uses
      At line 12 in file ..\Port\os_cpu_a.s
Comment: OS_CPU_SR_Restore used once
OS_CPU_SR_Save 00000000

Symbol: OS_CPU_SR_Save
   Definitions
      At line 78 in file ..\Port\os_cpu_a.s
   Uses
      At line 11 in file ..\Port\os_cpu_a.s
Comment: OS_CPU_SR_Save used once
PendSV_Handler 00000090

Symbol: PendSV_Handler
   Definitions
      At line 234 in file ..\Port\os_cpu_a.s
   Uses
      At line 16 in file ..\Port\os_cpu_a.s
Comment: PendSV_Handler used once
SystemInit 000000DA

Symbol: SystemInit



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 289 in file ..\Port\os_cpu_a.s
   Uses
      At line 17 in file ..\Port\os_cpu_a.s
Comment: SystemInit used once
Wait_Clock_Switch 00000136

Symbol: Wait_Clock_Switch
   Definitions
      At line 342 in file ..\Port\os_cpu_a.s
   Uses
      At line 346 in file ..\Port\os_cpu_a.s
Comment: Wait_Clock_Switch used once
Wait_HSE_Ready 000000E4

Symbol: Wait_HSE_Ready
   Definitions
      At line 295 in file ..\Port\os_cpu_a.s
   Uses
      At line 298 in file ..\Port\os_cpu_a.s
Comment: Wait_HSE_Ready used once
Wait_PLL_Ready 00000116

Symbol: Wait_PLL_Ready
   Definitions
      At line 326 in file ..\Port\os_cpu_a.s
   Uses
      At line 329 in file ..\Port\os_cpu_a.s
Comment: Wait_PLL_Ready used once
11 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

FLASH_ACR 40023C00

Symbol: FLASH_ACR
   Definitions
      At line 281 in file ..\Port\os_cpu_a.s
   Uses
      At line 303 in file ..\Port\os_cpu_a.s
Comment: FLASH_ACR used once
NVIC_INT_CTRL E000ED04

Symbol: NVIC_INT_CTRL
   Definitions
      At line 23 in file ..\Port\os_cpu_a.s
   Uses
      At line 181 in file ..\Port\os_cpu_a.s
Comment: NVIC_INT_CTRL used once
NVIC_PENDSVSET 10000000

Symbol: NVIC_PENDSVSET
   Definitions
      At line 26 in file ..\Port\os_cpu_a.s
   Uses
      At line 182 in file ..\Port\os_cpu_a.s
Comment: NVIC_PENDSVSET used once
NVIC_PENDSV_PRI 000000FF

Symbol: NVIC_PENDSV_PRI
   Definitions
      At line 25 in file ..\Port\os_cpu_a.s
   Uses
      At line 124 in file ..\Port\os_cpu_a.s
Comment: NVIC_PENDSV_PRI used once
NVIC_SYSPRI14 E000ED22

Symbol: NVIC_SYSPRI14
   Definitions
      At line 24 in file ..\Port\os_cpu_a.s
   Uses
      At line 123 in file ..\Port\os_cpu_a.s
Comment: NVIC_SYSPRI14 used once
RCC_AHB1ENR 40023830

Symbol: RCC_AHB1ENR
   Definitions
      At line 280 in file ..\Port\os_cpu_a.s
   Uses
      None
Comment: RCC_AHB1ENR unused
RCC_BASE 40023800

Symbol: RCC_BASE
   Definitions
      At line 276 in file ..\Port\os_cpu_a.s
   Uses
      At line 277 in file ..\Port\os_cpu_a.s
      At line 278 in file ..\Port\os_cpu_a.s
      At line 279 in file ..\Port\os_cpu_a.s
      At line 280 in file ..\Port\os_cpu_a.s




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

RCC_CFGR 40023808

Symbol: RCC_CFGR
   Definitions
      At line 279 in file ..\Port\os_cpu_a.s
   Uses
      At line 334 in file ..\Port\os_cpu_a.s
Comment: RCC_CFGR used once
RCC_CR 40023800

Symbol: RCC_CR
   Definitions
      At line 277 in file ..\Port\os_cpu_a.s
   Uses
      At line 290 in file ..\Port\os_cpu_a.s
      At line 321 in file ..\Port\os_cpu_a.s

RCC_PLLCFGR 40023804

Symbol: RCC_PLLCFGR
   Definitions
      At line 278 in file ..\Port\os_cpu_a.s
   Uses
      At line 310 in file ..\Port\os_cpu_a.s
Comment: RCC_PLLCFGR used once
SCB_SHPR3 E000ED20

Symbol: SCB_SHPR3
   Definitions
      At line 287 in file ..\Port\os_cpu_a.s
   Uses
      At line 365 in file ..\Port\os_cpu_a.s
Comment: SCB_SHPR3 used once
SYSTICK_BASE E000E010

Symbol: SYSTICK_BASE
   Definitions
      At line 282 in file ..\Port\os_cpu_a.s
   Uses
      At line 283 in file ..\Port\os_cpu_a.s
      At line 284 in file ..\Port\os_cpu_a.s
      At line 285 in file ..\Port\os_cpu_a.s
      At line 357 in file ..\Port\os_cpu_a.s

SYSTICK_CTRL E000E010

Symbol: SYSTICK_CTRL
   Definitions
      At line 283 in file ..\Port\os_cpu_a.s
   Uses
      None
Comment: SYSTICK_CTRL unused
SYSTICK_LOAD E000E014

Symbol: SYSTICK_LOAD
   Definitions
      At line 284 in file ..\Port\os_cpu_a.s
   Uses
      None



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Absolute symbols

Comment: SYSTICK_LOAD unused
SYSTICK_VAL E000E018

Symbol: SYSTICK_VAL
   Definitions
      At line 285 in file ..\Port\os_cpu_a.s
   Uses
      None
Comment: SYSTICK_VAL unused
15 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

OSIntExit 00000000

Symbol: OSIntExit
   Definitions
      At line 6 in file ..\Port\os_cpu_a.s
   Uses
      None
Comment: OSIntExit unused
OSPrioCur 00000000

Symbol: OSPrioCur
   Definitions
      At line 2 in file ..\Port\os_cpu_a.s
   Uses
      At line 140 in file ..\Port\os_cpu_a.s
      At line 254 in file ..\Port\os_cpu_a.s

OSPrioHighRdy 00000000

Symbol: OSPrioHighRdy
   Definitions
      At line 3 in file ..\Port\os_cpu_a.s
   Uses
      At line 141 in file ..\Port\os_cpu_a.s
      At line 255 in file ..\Port\os_cpu_a.s

OSRunning 00000000

Symbol: OSRunning
   Definitions
      At line 1 in file ..\Port\os_cpu_a.s
   Uses
      At line 136 in file ..\Port\os_cpu_a.s
Comment: OSRunning used once
OSTCBCur 00000000

Symbol: OSTCBCur
   Definitions
      At line 4 in file ..\Port\os_cpu_a.s
   Uses
      At line 145 in file ..\Port\os_cpu_a.s
      At line 246 in file ..\Port\os_cpu_a.s

OSTCBHighRdy 00000000

Symbol: OSTCBHighRdy
   Definitions
      At line 5 in file ..\Port\os_cpu_a.s
   Uses
      At line 146 in file ..\Port\os_cpu_a.s
      At line 259 in file ..\Port\os_cpu_a.s

OSTaskSwHook 00000000

Symbol: OSTaskSwHook
   Definitions
      At line 7 in file ..\Port\os_cpu_a.s
   Uses
      At line 134 in file ..\Port\os_cpu_a.s



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
External symbols

      At line 252 in file ..\Port\os_cpu_a.s

OS_CPU_ExceptStkBase 00000000

Symbol: OS_CPU_ExceptStkBase
   Definitions
      At line 8 in file ..\Port\os_cpu_a.s
   Uses
      At line 130 in file ..\Port\os_cpu_a.s
Comment: OS_CPU_ExceptStkBase used once
OS_KA_BASEPRI_Boundary 00000000

Symbol: OS_KA_BASEPRI_Boundary
   Definitions
      At line 9 in file ..\Port\os_cpu_a.s
   Uses
      None
Comment: OS_KA_BASEPRI_Boundary unused
9 symbols
370 symbols in table
